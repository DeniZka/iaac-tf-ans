---
# tasks file for nginx
- name: install nginx
  apt:
    pkg:
      - nginx
      - certbot
      - python3-certbot-nginx
      - python3-acme
      - python3-certbot
      - prometheus-node-exporter
    state: latest
- name: prepare nginx
  shell: sed -i 's/_;/bms-devops.ru;/g' /etc/nginx/sites-available/default
- name: prepare for certbot
  shell: mkdir -p /var/www/html/.well-known/acme-challenge/
- name: configure certbot
  shell: certbot --test-cert --nginx -d bms-devops.ru -d www.bms-devops.ru -d gitlab.bms-devops.ru -d grafana.bms-devops.ru -d prometheus.bms-devops.ru -d alertmanager.bms-devops.ru --register-unsafely-without-email -n --agree-tos
  
#-d test.bms-devops.ru
